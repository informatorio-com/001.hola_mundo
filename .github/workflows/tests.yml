name: test-exercise

# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

on:
  push:
    branches: ["master"]

env:
  PYTHON_VERSION: 3.10.1

jobs:
  tests:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master'
    steps:
      - uses: actions/checkout@v3

      - name: "Install needed libraries"
        if: github.ref == 'refs/heads/master'
        shell: bash
        run: |
          python -m pip install --upgrade pip
          pip install -r .github/requirements.txt
      
      - name: "Run tests"
        if: github.ref == 'refs/heads/master'
        shell: bash
        run: |
          pytest .github/tests/

      - name: "Notify status of failure job"
        if: ${{ failure() }}
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{"content": "Something in the exercise was wrong! âš ï¸\nStatus: `${{ job.status }}` ğŸ’¥ğŸ‘» \nAutor: @${{ github.actor }} \nLink: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"}' \
          ${{ secrets.TEAMS_WEBHOOK_URL_NOT_OK }}
  
  notification:
    runs-on: ubuntu-latest
    needs: [tests]
    steps:
      - name: Notify teams
        run: |
          curl -X POST -H "Content-Type: application/json" \
          -d '{"content": "The tests passed succesfully! ğŸš€\nStatus: `${{ job.status }}` ğŸ»âœ… \nAutor: @${{ github.actor }} \nLink: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"}' \
          ${{ secrets.TEAMS_WEBHOOK_URL_OK }}
